<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Product Manager</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body{font-family: Arial; margin:20px}
        table{border-collapse:collapse; width:80%}
        th,td{border:1px solid #ccc; padding:8px}
    </style>
</head>
<body>
<h1>Product Manager</h1>

<form id="productForm">
    <input type="hidden" id="id" />
    <input id="name" placeholder="Name" required />
    <input id="price" placeholder="Price" type="number" step="0.01" required />
    <button type="submit">Save</button>
    <button type="button" id="resetBtn">Reset</button>
</form>

<h2>Products</h2>
<table id="productTable">
    <thead><tr><th>ID</th><th>Name</th><th>Price</th><th>Actions</th></tr></thead>
    <tbody></tbody>
</table>

<script>
    const api = '/api/products';

    async function fetchProducts(){
        const res = await fetch(api);
        const list = await res.json();
        const tbody = document.querySelector('#productTable tbody');
        tbody.innerHTML = '';
        list.forEach(p => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${p.id}</td>
      <td>${escapeHtml(p.name)}</td>
      <td>${p.price}</td>
      <td>
        <button onclick="edit(${p.id})">Edit</button>
        <button onclick="del(${p.id})">Delete</button>
      </td>`;
            tbody.appendChild(tr);
        });
    }

    function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    document.getElementById('productForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('id').value;
        const name = document.getElementById('name').value;
        const price = parseFloat(document.getElementById('price').value);
        const payload = { name, price };
        if(id){
            await fetch(`${api}/${id}`, { method: 'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
        } else {
            await fetch(api, { method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
        }
        resetForm();
        fetchProducts();
    });

    document.getElementById('resetBtn').addEventListener('click', resetForm);

    function resetForm(){
        document.getElementById('id').value='';
        document.getElementById('name').value='';
        document.getElementById('price').value='';
    }

    async function edit(id){
        const res = await fetch(`${api}/${id}`);
        if(res.ok){
            const p = await res.json();
            document.getElementById('id').value = p.id;
            document.getElementById('name').value = p.name;
            document.getElementById('price').value = p.price;
        }
    }

    async function del(id){
        if(!confirm('Delete?')) return;
        await fetch(`${api}/${id}`, { method: 'DELETE' });
        fetchProducts();
    }

    fetchProducts();
</script>
</body>
</html>
